name: build test

on:
  push:
    paths-ignore:
      - '*.md'
      - '*.mp3'
  pull_request:
    branches: [ master ]

jobs:
  build-macos:
    name: build in native macOS
    runs-on: macos-latest
    strategy:
      fail-fast: false
      matrix:
        arch: [aarch64]
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      # - name: build ffmpeg
      #   run: |
      #     while sleep 300; do echo "=====[ $SECONDS seconds still running ]====="; done &
      #     SKIPINSTALL=yes VERBOSE=yes ./build-ffmpeg --build
      #     kill %1
      # - name: check shared library
      #   run: |
      #     otool -L ./workspace/bin/ffmpeg
      # - name: test run ffmepg
      #   run: |
      #     ./workspace/bin/ffmpeg -buildconf
      # - name: clean up
      #   run: |
      #     ./build-ffmpeg --cleanup
      # - name: Compress build folder
      #   run: |
      #     tar -czf build.tar.gz workspace/
      # - name: Upload release assets
      #   id: action_gh_release
      #   uses: softprops/action-gh-release@v2
      #   env:
      #     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      #   with:
      #     name: ffmpeg
      #     files: build.tar.gz
      #     prerelease: false
      - name: Brew
        run: |
          brew install curl opencv
